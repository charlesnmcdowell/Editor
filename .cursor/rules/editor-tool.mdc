---
alwaysApply: true
---
# Style Editor Project Rules

## Architecture
This is a Python CLI tool that edits fiction chapters using Claude, learning the author's style over time.
Stage 2 - file-based editing workflow. No paragraph-level diffing.

### Working Files (repo root)
- original.md - raw chapter text (input)
- edited.md - human feedback/comments inline (optional input)
- aiedited.md - AI reasoning log (output, auto-generated)
- final.md - clean edited chapter (output)
- authorpreferences.md - persistent style preferences, plain English (grows over time)

### Data Flow
1. Read original.md (required) and edited.md (optional feedback)
2. Detect mode: Human Feedback (edited.md has content) or AI-Only (empty)
3. Call Claude with original + feedback + preferences -> get reasoning + final chapter
4. In Human Feedback mode: second API call extracts new preferences from feedback
5. Archive working files to history/{timestamp}_{mode}/ and wipe

### Modules
- prompts.py - all Claude system prompts
- analyzer.py - Claude API calls (edit_with_feedback, edit_ai_only, update_preferences)
- profile.py - file I/O for all working files
- archive.py - timestamped archiving and file wiping
- cli.py - Click CLI: edit, preferences, history, reset

### Conventions
- Model: claude-sonnet-4-20250514 via anthropic SDK
- API key from .env via python-dotenv
- Claude outputs split on ===FINAL=== delimiter (reasoning above, chapter below)
- authorpreferences.md is plain English, not JSON - human-readable and hand-editable
- Archive folders: history/{YYYY-MM-DD_HHMMSS}_{human|ai}/
- Working files are wiped after archive (except final.md stays for reference)
